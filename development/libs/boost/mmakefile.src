# Copyright 2018-2025, The AROS Development Team. All rights reserved.
# $Id: mmakefile.src $

include $(SRCDIR)/config/aros-contrib.cfg

BOOSTVERSION=1.88.0
BOOSTVRS=1_88_0
ARCHBASE     := boost_$(BOOSTVRS)
ARCHSRCDIR := $(PORTSDIR)/boost/$(ARCHBASE)
boostlib-buildflag := $(GENDIR)/$(CURDIR)/.buildflag-boostlib-$(BOOSTVERSION)-$(AROS_TARGET_CPU)
boostlib-installflag := $(GENDIR)/$(CURDIR)/.installflag-boostlib-$(BOOSTVERSION)-$(AROS_TARGET_CPU)

#MM- contrib-development : development-libs-boost
#MM development-libs-boost : development-libs-boost-copy-src
#MM- development-libs-boost-quick : development-libs-boost
#MM- development-libs-boost-copy-src : compiler-boost-fetch

%copy_dir_recursive mmake=development-libs-boost-copy-src src=$(ARCHSRCDIR) dst=$(GENDIR)/$(CURDIR)

#MM
development-libs-boost:
	@$(IF) ! $(TEST) -f $(boostlib-buildflag) ; then \
		cd "$(GENDIR)/$(CURDIR)" && \
		$(ECHO) "Bootstrapping boost..." && \
		chmod +x "$(ARCHSRCDIR)/bootstrap.sh" && \
		$(ARCHSRCDIR)/bootstrap.sh --prefix=$(AROS_DEVELOPER) --with-libraries=system,filesystem,iostreams > $(GENDIR)/$(CURDIR)/bootstrap.log 2>&1 && \
		$(ECHO) "Building boost libraries..." && \
		$(ECHO) "using gcc : : \"$(AROS_CXX)\" : <compileflags>\"$(CXXFLAGS)\" <linkflags>\"$(LDFLAGS)\" ;\n" > $(GENDIR)/$(CURDIR)/user-config.jam && \
		$(GENDIR)/$(CURDIR)/b2 --quiet -sBOOST_ROOT="$(GENDIR)/$(CURDIR)" toolset=gcc && \
		$(TOUCH) $(boostlib-buildflag) ; \
	fi
	@$(IF) $(TEST) -f $(boostlib-buildflag) \
	    && ! $(TEST) -f $(boostlib-installflag) ; then \
		$(ECHO) "Installing boost libraries..." && \
		cp $(GENDIR)/$(CURDIR)/stage/lib/lib*.a $(AROS_DEVELOPER)/lib && \
		$(TOUCH) $(boostlib-installflag) ; \
	fi

%common
